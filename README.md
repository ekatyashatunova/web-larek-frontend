# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара

```

export interface IProductItem {
    id: string,
    image: string,
    category: string,
    title: string,
    description: string,
    price: number
}
```

Интерфейс для каталога товаров

```

export interface IProductList {
    items: IProductItem[],
    preview: string | null
}
```

Данные пользователя

```

export interface IUser {
    payment: string,
    email: string,
    addres: string,
    phone: number
}
```

Данные пользователя в форме с адресом и способом оплаты

```

export type TUserOrder = Pick<IUser, 'payment' | 'addres'>
```

Данные пользователя в форме с почтой и телефоном

```

export type TUserContacts = Pick<IUser, 'email' | 'phone'>
```

Корзина с товарами

```

export type TBasketOrder = Pick<IProductItem, 'title' | 'price' | 'id'>
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных,
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс API
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес 
сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запросна переданный в параметрах ендпоинт и возвращает промис с
объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и 
отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию
выполняется `POST` запрос,но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе.
Класс используется в презентере для обработки событий и в слоях приложения для генерации события.
Основыне методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс BasketData
Класс отвечает за логику и хранение данных товаров в корзине.
Конструктор принимает инстант брокера событий.
В классе есть следующие поля:
- _products: IProductItem[] - хранение массива карточек товаров
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

В классе есть следующие методы:
- getAllProducts(): IProductItem[]- получить массив товаров
- addProduct(product: IProductItem): void - добавить товар в корзину
- deleteProduct(product: IProductItem): void; - удалить товар из корзины.
- checkBasket(id: string): boolean - проверить есть ли товар с id уже в корзине
- getTotalPrice(): number - получить общую стоимость товаров.
- getProductsCounter(): number - получить общее количество товаров в корзине.
- getProductIds() - получить все id товаров 
- clearBasket(): void - очистить корзину.

#### Класс UserData
Класс отвечает за хранение и логику работы с данными покупателя.
Конструктор класса принимает инстант брокера событий.
В классе есть следующие поля:
- payment: string - способ оплаты
- email: string - электронная почта покупателя
- addres: string - адрес доставки покупателя
- phone: number - номер телефона покупателя
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

В классе есть следующие методы:
- getUserOrder(): TUserOrder - возвращает данные покупателя
- validationContactsForm(): boolean - валидация формы с контактами
- validationPaymentForm(): boolean - валидация формы с адресом и способом оплаты
- clearUserData() - очистка данных покупателя

#### Класс Catalog
Класс отвечает за хранение и логику работы с каталогом товаров на странице.
В классе есть следующие поля:
- products: IProductItem[] - массив карточек товаров

В классе есть следующие методы:
- setProduct(products: IProductItem[]): void - сохранить/установить массив карточек с сервера
- getProducts(): IProductItem[] - возвращает/получает массив карточек
- getProduct(cardId: string) - получаем карточку товара по ее id

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элементов) передаваемых в них данных.

#### Базовый класс Component 
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттерыБ возвращает обновленный контейнер компонента.

#### Класс ProductCard
Отвечает за отображение карточки товара, задавая в карточке данные изображения, названия, описания, категории, стоимости и id товара.
Класс используется для отображения карточек товаров на главной странице приложения. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы.
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке будет идентифицированы карточки товара и `EventEmitter` для возможности инициации событий

Поля класса:
 - id: string - id  карточки товара
 - category: <HTMLElement> - отображение категории товара
 - title: <HTMLElement> - отображение название товара
 - image: <HTMLImageElement> - отображение изображения товара
 - price: <HTMLElement> - отображение стоимости товара
 - description: <HTMLElement> - отображение описания товара
 - buttonsDelete: <HTMLButtonElement> - кнопки удаления товара из корзины
 - basketIndex: <HTMLElement> - индекс товара в корзине
 - events: IEvents - брокер событий

Методы:
- геттер id - возвращает уникальный id карточки товара
- сеттеры для сохранения данных из полей класса

#### Класс Page
Отвечает за отображение контента на главной странице. В конструктор принимает контейнер, в котором размещаются карточки.

Поля класса:
- _cardsCatalog: <HTMLElement> - каталог карточек товаров на странице
- buttonBasket: <HTMLButtonElement> - кнопка для корзины
- _counterBasket: <HTMLElement> - отображение счетчика товаров в корзине
- _wrapper: HTMLElement: <HTMLElement> - для блокировки движения модального окна на экране
- events: IEvents - брокер событий

Методы:
- open(): void - открытие модального окна корзины
- сеттеры для сохранения данных из полей класса

#### Класс Modal
Отвечает за работу с модальными окнами. 
Конструктор создает элементы HTML и добавляет обработчик события для кнопки закрытия.

Поля класса:
- _closeButton: <HTMLButtonElement>  - кнопка закрытия модального окна
- _content: <HTMLElement> - содержимое модального окна
- events: IEvents - брокер событий

Методы:
- open() - открывает модальное окно
- close() - закрывает модальное окно
- setContent(): <HTMLElement> - устанавливает контент модального окна
- handleEscUp - закрытие подального окна по клавише "ESC"
- render(data: IModal): <HTMLElement> - возвращает заполенное данными модальное окно

#### Класс Basket
Отвечает за отображение корзины товаров.
В классе устанавливаются слушатели на все интерактивные элементы.

Поля класса:
- basketList: <HTMLElement> - товары в корзине
- basketPrice: <HTMLElement> - стоимость товаров в корзине
- orderButton: <HTMLButtonElement> - кнопка оформления заказа

Методы:
- click() - открывает попап формы данных пользователя (кнопка 'Оформить')
- сеттеры для сохранения данных из полей класса

#### Класс Form
Родительский класс. Отвечает за отображение формы, которую заполняют данными пользователя.

Поля класса:
- submitButton: <HTMLElement> - кнопка подтвержения
- _errors: <HTMLElement> - хранит все элементы для вывода ошибок

Методы:
- set valid(value: boolean) - изменяет активность кнопки 
- сеттеры для сохранения/установки данных из полей класса
- onInputChange(field: keyof T, value: string) - метод для заполнения инпутов
- render(state: Partial<T> & IForm) - возвращает заполненную форму
- submit - обрабатывает событие отправки формы

#### Класс PaymentForm
Расширяет класс Form. Отвечает за отображение информации о пользователе на странице. В модальном окне можно выбрать способ оплаты и внести информацию об адресе.   
В классе устанавливаются слушатели на все интерактивные элементы.

Поля класса:
- paymentCard: <HTMLButtonElement> - кнопка способа оплаты картой
- paymentCash: <HTMLButtonElement> - кнопка способа оплаты при получении
- addressInput: <HTMLInputElement> - поле для ввода адреса

Методы:
- click() - выбираем способ оплаты кликом
- сеттеры для сохранения/установки данных из полей класса

#### Класс ContactsForm
Расширяет класс Form. Отвечает за отображение информации о пользователе на странице. В модальном окне можно внести информацию об электронной почте и номере телефона покупателя.
В классе устанавливаются слушатели на все интерактивные элементы.

Поля класса:
- email: <HTMLInputElement> - поле для ввода электронной почты
- phone: <HTMLInputElement> - поле для ввода номера телефона

Методы:
- сеттеры для сохранения данных из полей класса

#### Класс SuccessPay
Расширяет класс Form. Отвечает за отображение модального окна в случае успешной покупки.

Поля класса:
- _total: <HTMLButtonElement> - отображение общей стоимости покупки
- buttonSuccessClose: <HTMLButtonElement> - кнопка 'За новыми покупками',при нажатии которой происходит событие закрытия

Методы:
- click() - обработчик события закрытия окна успешной оплаты, нажав на кнопку 'За новыми покупками'
- сеттер для сохранения/установки данных из поля класса

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализации с бэкендом сервиса.

Методы:
- getProducts(): Promise<IProductList>  - ответ с сервера с массивом карточек, получаем массив карточек
- setProducts(cards: IProductItem[]): Promise<IProductItem[]> - отправляет данные на сервер и получает ответ

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счёт событий генерируемых с помощью брокера событий, описанных в `index.ts`.
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)
- `productsCard:loaded` - загрузка карточек с сервера

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `product:open` - открытие модального окна карточки товара
- `basket:open` - открытие модального окна корзины товаров
- `product:delete` - удалить товар из корзины
- `product:add` - добавить товар в корзину
- `basket:add` - изменение в корзине после добавления в нее товара
- `basket:delete` - изменения в корзине после удаления товара из нее
- `form:open` - при нажатии на кнопку 'Оформить' открывается форма с данными пользователя
- `payment:select` - выбрать способ оплаты
- `formErrors:change` - событие, которое генерируется если в поле формы с контактами есть ошибка
- `formPaymentErrors:change` - событие, которое генерируется если в поле формы с оплатой есть ошибка
- `order:submit` - событие, генерируемое при нажатии кнопки 'Далее'
- `contacts:submit` - событие, генерируемое при нажатии кнопки 'Оплатить'
- `address:change` - изменение адреса в форме с данными пользователя
- `email:change` - изменение электроннйо почты в форме с данными пользователя
- `phone:change` - изменение номера телефона в форме с данными пользователя
- `order:success` - событие, генерируемое при нажатии кнопки 'За новыми покупками'




